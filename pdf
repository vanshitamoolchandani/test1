package com.example.pdfconverter.util;

import com.adobe.pdfservices.operation.ExecutionContext;
import com.adobe.pdfservices.operation.auth.Credentials;
import com.adobe.pdfservices.operation.io.FileRef;
import com.adobe.pdfservices.operation.pdfops.ExportPDFOperation;
import com.adobe.pdfservices.operation.pdfops.ExportPDFTargetFormat;

import java.io.InputStream;
import java.io.ByteArrayOutputStream;

public class AdobePdfConverter {

    public static ByteArrayOutputStream convertToDocx(InputStream pdfInputStream) {
        try {
            // 1️⃣ Load credentials
            Credentials credentials = Credentials.serviceAccountCredentialsBuilder()
                    .fromFile("pdfservices-api-credentials.json")
                    .build();

            // 2️⃣ Create execution context
            ExecutionContext context = ExecutionContext.create(credentials);

            // 3️⃣ Create export operation for DOCX
            ExportPDFOperation operation = ExportPDFOperation.createNew(ExportPDFTargetFormat.DOCX);

            // 4️⃣ Set input from InputStream (modern SDK way)
            FileRef source = FileRef.createFromStream(pdfInputStream, ExportPDFTargetFormat.PDF.name());
            operation.setInput(source);

            // 5️⃣ Execute the operation
            FileRef result = operation.execute(context);

            // 6️⃣ Get output as a stream (no file saving needed)
            ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
            result.saveAs(outputStream);

            return outputStream;

        } catch (Exception e) {
            throw new RuntimeException("Adobe PDF conversion failed", e);
        }
    }
}